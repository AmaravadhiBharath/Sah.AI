console.log("[PromptExtractor] Service worker started");const a=new Set;let s=null;chrome.sidePanel.setPanelBehavior({openPanelOnActionClick:!0});chrome.runtime.onConnect.addListener(e=>{e.name==="sidepanel"&&(console.log("[PromptExtractor] Side panel connected"),a.add(e),s&&e.postMessage({action:"EXTRACTION_RESULT",result:s}),e.onMessage.addListener(t=>{E(t)}),e.onDisconnect.addListener(()=>{console.log("[PromptExtractor] Side panel disconnected"),a.delete(e)}))});let r=null;chrome.runtime.onMessage.addListener((e,t,o)=>{var i;switch(console.log("[PromptExtractor] Received message:",e.action),e.action){case"EXTRACTION_FROM_PAGE":{const{result:n,mode:d}=e;s=n,r={result:n,mode:d};const l=(i=t.tab)==null?void 0:i.windowId;l&&chrome.sidePanel.open({windowId:l}).then(()=>{console.log("[PromptExtractor] Side panel opened"),setTimeout(()=>{r&&(c({action:"EXTRACTION_FROM_PAGE_RESULT",result:r.result,mode:r.mode}),r=null)},500)}).catch(u=>{console.error("[PromptExtractor] Error opening side panel:",u)}),o({success:!0});break}case"EXTRACTION_RESULT":{const n=e.result;s=n,c({action:"EXTRACTION_RESULT",result:n}),o({success:!0});break}case"STATUS_RESULT":{c(e),o({success:!0});break}default:o({success:!1,error:"Unknown action"})}return!0});async function E(e){switch(console.log("[PromptExtractor] Side panel message:",e.action),e.action){case"EXTRACT_PROMPTS":{const t=e.mode,[o]=await chrome.tabs.query({active:!0,currentWindow:!0});o!=null&&o.id&&chrome.tabs.sendMessage(o.id,{action:"EXTRACT_PROMPTS",mode:t});break}case"GET_STATUS":{const[t]=await chrome.tabs.query({active:!0,currentWindow:!0});t!=null&&t.id&&chrome.tabs.sendMessage(t.id,{action:"GET_STATUS"},o=>{o&&c(o)});break}case"SUMMARIZE_PROMPTS":{const t=e.prompts;c({action:"SUMMARY_RESULT",result:{original:t,summary:t.map(o=>o.content).join(`

---

`),promptCount:{before:t.length,after:t.length}}});break}}}function c(e){a.forEach(t=>{try{t.postMessage(e)}catch(o){console.error("[PromptExtractor] Error sending to side panel:",o),a.delete(t)}})}chrome.runtime.onInstalled.addListener(()=>{console.log("[PromptExtractor] Extension installed")});
