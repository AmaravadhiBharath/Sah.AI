var N=Object.defineProperty;var _=(s,n,e)=>n in s?N(s,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[n]=e;var m=(s,n,e)=>_(s,typeof n!="symbol"?n+"":n,e);class h{deepQuerySelectorAll(n,e=document){let t=Array.from(e.querySelectorAll(n));const l=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT);let d;for(;d=l.nextNode();){const i=d;i.shadowRoot&&(t=[...t,...this.deepQuerySelectorAll(n,i.shadowRoot)])}return t}cleanText(n){return n.replace(/\s+/g," ").trim()}isUIElement(n){return/^(copy|regenerate|share|edit|delete|save|retry|cancel|submit|send|stop|continue|new chat|clear)$/i.test(n.trim())||n.trim().length<3}getVisibleText(n){const e=n;return e.innerText||e.textContent||""}}class V extends h{constructor(){super(...arguments);m(this,"name","chatgpt")}detect(){return location.hostname.includes("chatgpt.com")||location.hostname.includes("chat.openai.com")}scrapePrompts(){const e=[],t=new Set,l=document.querySelectorAll('[data-message-author-role="user"]');if(l.length>0&&(l.forEach((a,r)=>{const o=this.cleanText(this.getVisibleText(a));o&&!this.isUIElement(o)&&!t.has(o)&&(t.add(o),e.push({content:o,index:r}))}),e.length>0))return e;const d=document.querySelectorAll("article");let i=0;return d.forEach(a=>{const r=a.querySelector(".markdown"),o=a.querySelector(".agent-turn");if(r||o)return;const c=this.cleanText(this.getVisibleText(a));c&&c.length>5&&!t.has(c)&&(t.add(c),e.push({content:c,index:i++}))}),e}}class U extends h{constructor(){super(...arguments);m(this,"name","claude")}detect(){return location.hostname.includes("claude.ai")}scrapePrompts(){const e=[],t=new Set,l=document.querySelectorAll('[data-testid="human-message"], .human-message, [class*="human"]');if(l.length>0&&(l.forEach((a,r)=>{const o=this.cleanText(this.getVisibleText(a));o&&!this.isUIElement(o)&&!t.has(o)&&(t.add(o),e.push({content:o,index:r}))}),e.length>0))return e;const d=document.querySelectorAll('[class*="message"], [class*="Message"]');let i=0;if(d.forEach(a=>{const r=a.className.toLowerCase();if(!(r.includes("assistant")||r.includes("ai")||r.includes("claude"))&&(r.includes("user")||r.includes("human"))){const o=this.cleanText(this.getVisibleText(a));o&&o.length>5&&!t.has(o)&&(t.add(o),e.push({content:o,index:i++}))}}),e.length===0){const a=document.querySelector('[class*="conversation"], [class*="chat"], main');a&&a.querySelectorAll(":scope > div").forEach((o,c)=>{if(!o.querySelector(".prose, .markdown, pre, code")){const u=this.cleanText(this.getVisibleText(o));u&&u.length>10&&!t.has(u)&&(t.add(u),e.push({content:u,index:c}))}})}return e}}class B extends h{constructor(){super(...arguments);m(this,"name","gemini")}detect(){return location.hostname.includes("gemini.google.com")}scrapePrompts(){const e=[],t=new Set,l=this.deepQuerySelectorAll('user-query, [class*="user-query"], [class*="query-text"]');if(l.length>0&&(l.forEach((i,a)=>{const r=this.cleanText(this.getVisibleText(i));r&&!this.isUIElement(r)&&!t.has(r)&&(t.add(r),e.push({content:r,index:a}))}),e.length>0))return e;if(this.deepQuerySelectorAll(".query-content, .user-message, [data-query]").forEach((i,a)=>{const r=this.cleanText(this.getVisibleText(i));r&&r.length>3&&!t.has(r)&&(t.add(r),e.push({content:r,index:a}))}),e.length===0){const i=document.querySelector('main, [role="main"]');if(i){const a=i.querySelectorAll('[class*="turn"], [class*="message"]');let r=0;a.forEach(o=>{const c=o.className.toLowerCase();if(c.includes("model")||c.includes("response")||c.includes("answer"))return;const u=this.cleanText(this.getVisibleText(o));u&&u.length>5&&!t.has(u)&&(t.add(u),e.push({content:u,index:r++}))})}}return e}}class O extends h{constructor(){super(...arguments);m(this,"name","perplexity")}detect(){return location.hostname.includes("perplexity.ai")}scrapePrompts(){const e=[],t=new Set;if(document.querySelectorAll('[class*="query"], [class*="question"], [class*="user"]').forEach((d,i)=>{const a=d.className.toLowerCase();if(a.includes("answer")||a.includes("response")||a.includes("source"))return;const r=this.cleanText(this.getVisibleText(d));r&&r.length>5&&!this.isUIElement(r)&&!t.has(r)&&(t.add(r),e.push({content:r,index:i}))}),e.length===0){const d=document.querySelectorAll('[class*="thread"] > div, [class*="Thread"] > div');let i=0;d.forEach((a,r)=>{if(r%2===0){const o=this.cleanText(this.getVisibleText(a));o&&o.length>5&&!t.has(o)&&(t.add(o),e.push({content:o,index:i++}))}})}return e.length===0&&document.querySelectorAll('h1, h2, [class*="title"]').forEach((i,a)=>{const r=this.cleanText(this.getVisibleText(i));r&&r.length>10&&r.length<500&&!t.has(r)&&(t.add(r),e.push({content:r,index:a}))}),e}}class R extends h{constructor(){super(...arguments);m(this,"name","deepseek")}detect(){return location.hostname.includes("deepseek.com")}scrapePrompts(){const e=[],t=new Set;if(document.querySelectorAll('[class*="user"], [class*="User"], [data-role="user"]').forEach((a,r)=>{const o=this.cleanText(this.getVisibleText(a));o&&!this.isUIElement(o)&&!t.has(o)&&(t.add(o),e.push({content:o,index:r}))}),e.length>0)return e;const d=document.querySelectorAll('[class*="bubble"], [class*="message"]');let i=0;return d.forEach(a=>{const r=a.className.toLowerCase();if(!(r.includes("assistant")||r.includes("bot")||r.includes("ai"))&&(r.includes("user")||r.includes("human"))){const o=this.cleanText(this.getVisibleText(a));o&&o.length>3&&!t.has(o)&&(t.add(o),e.push({content:o,index:i++}))}}),e.length===0&&document.querySelectorAll("main div").forEach((r,o)=>{if(!r.querySelector(".ds-markdown")&&!r.closest(".ds-markdown")){const c=this.cleanText(this.getVisibleText(r));c&&c.length>10&&c.length<2e3&&!t.has(c)&&!c.includes("```")&&!c.startsWith("#")&&(t.add(c),e.push({content:c,index:o}))}}),e}}class D extends h{constructor(){super(...arguments);m(this,"name","lovable")}detect(){return location.hostname.includes("lovable.dev")}scrapePrompts(){const e=[],t=new Set;if(document.querySelectorAll('[class*="user-message"], [class*="UserMessage"], [data-sender="user"]').forEach((i,a)=>{const r=this.cleanText(this.getVisibleText(i));r&&!this.isUIElement(r)&&!t.has(r)&&(t.add(r),e.push({content:r,index:a}))}),e.length>0)return e;if(document.querySelectorAll('[class*="editable"], [class*="edit-button"]').forEach((i,a)=>{const r=i.closest('[class*="message"]');if(r){const o=this.cleanText(this.getVisibleText(r));o&&o.length>5&&!t.has(o)&&(t.add(o),e.push({content:o,index:a}))}}),e.length===0){const i=document.querySelector('[class*="chat"], [class*="conversation"], [class*="messages"]');if(i){const a=i.querySelectorAll(":scope > div");let r=0;a.forEach(o=>{const c=o.className.toLowerCase();if(c.includes("bot")||c.includes("assistant")||c.includes("ai")||c.includes("system"))return;const u=this.cleanText(this.getVisibleText(o));u&&u.length>5&&!t.has(u)&&(t.add(u),e.push({content:u,index:r++}))})}}return e}}class $ extends h{constructor(){super(...arguments);m(this,"name","bolt")}detect(){return location.hostname.includes("bolt.new")}scrapePrompts(){const e=[],t=new Set;if(document.querySelectorAll('[class*="user"], [class*="prompt"], [class*="input-message"]').forEach((a,r)=>{const o=a.className.toLowerCase();if(o.includes("assistant")||o.includes("response")||o.includes("output"))return;const c=this.cleanText(this.getVisibleText(a));c&&!this.isUIElement(c)&&!t.has(c)&&(t.add(c),e.push({content:c,index:r}))}),e.length>0)return e;const d=document.querySelectorAll('[class*="message"], [class*="Message"]');let i=0;return d.forEach(a=>{const r=a.className.toLowerCase();if(r.includes("user")||r.includes("human")||r.includes("you")){const o=this.cleanText(this.getVisibleText(a));o&&o.length>3&&!t.has(o)&&(t.add(o),e.push({content:o,index:i++}))}}),e.length===0&&document.querySelectorAll('[class*="workspace"] [class*="prompt"], [class*="project"] [class*="request"]').forEach((r,o)=>{const c=this.cleanText(this.getVisibleText(r));c&&c.length>5&&!t.has(c)&&(t.add(c),e.push({content:c,index:o}))}),e}}class G extends h{constructor(){super(...arguments);m(this,"name","cursor")}detect(){return location.hostname.includes("cursor.sh")||location.hostname.includes("cursor.com")}scrapePrompts(){const e=[],t=new Set;if(document.querySelectorAll('[class*="user-message"], [class*="UserMessage"], [data-role="user"]').forEach((a,r)=>{const o=this.cleanText(this.getVisibleText(a));o&&!this.isUIElement(o)&&!t.has(o)&&(t.add(o),e.push({content:o,index:r}))}),e.length>0)return e;const d=document.querySelectorAll('[class*="chat"] [class*="message"], [class*="conversation"] [class*="turn"]');let i=0;return d.forEach(a=>{const r=a.className.toLowerCase();if(r.includes("assistant")||r.includes("bot")||r.includes("ai")||r.includes("response"))return;const o=this.cleanText(this.getVisibleText(a));o&&o.length>3&&!t.has(o)&&(t.add(o),e.push({content:o,index:i++}))}),e.length===0&&document.querySelectorAll('[class*="command"], [class*="prompt-history"], [class*="input-history"]').forEach((r,o)=>{const c=this.cleanText(this.getVisibleText(r));c&&c.length>5&&!t.has(c)&&(t.add(c),e.push({content:c,index:o}))}),e}}class F extends h{constructor(){super(...arguments);m(this,"name","meta-ai")}detect(){return location.hostname.includes("meta.ai")}scrapePrompts(){const e=[],t=new Set;if(document.querySelectorAll('[class*="user"], [class*="User"], [data-type="user"]').forEach((a,r)=>{const o=a.className.toLowerCase();if(o.includes("assistant")||o.includes("response")||o.includes("meta"))return;const c=this.cleanText(this.getVisibleText(a));c&&!this.isUIElement(c)&&!t.has(c)&&(t.add(c),e.push({content:c,index:r}))}),e.length>0)return e;const d=document.querySelectorAll('[class*="bubble"], [class*="Bubble"]');let i=0;if(d.forEach(a=>{const r=a.className.toLowerCase();if(r.includes("right")||r.includes("user")||r.includes("outgoing")){const o=this.cleanText(this.getVisibleText(a));o&&o.length>3&&!t.has(o)&&(t.add(o),e.push({content:o,index:i++}))}}),e.length===0){const a=document.querySelector('[class*="thread"], [class*="conversation"], [role="log"]');a&&a.querySelectorAll(":scope > div, :scope > li").forEach((o,c)=>{if(o.querySelector('.markdown, pre, code, [class*="response"]'))return;const u=this.cleanText(this.getVisibleText(o));u&&u.length>5&&u.length<2e3&&!t.has(u)&&(t.add(u),e.push({content:u,index:c}))})}return e}}class H extends h{constructor(){super(...arguments);m(this,"name","generic")}detect(){return!0}scrapePrompts(){const e=[],t=new Set,l=['[data-role="user"]','[data-message-author-role="user"]','[class*="user-message"]','[class*="UserMessage"]','[class*="human-message"]','[class*="HumanMessage"]',".user",".human"];for(const i of l){const a=document.querySelectorAll(i);if(a.length>0&&(a.forEach((r,o)=>{const c=this.cleanText(this.getVisibleText(r));c&&c.length>3&&!this.isUIElement(c)&&!t.has(c)&&(t.add(c),e.push({content:c,index:o}))}),e.length>0))return e}return document.querySelectorAll('[class*="chat"], [class*="conversation"], [class*="messages"], [role="log"]').forEach(i=>{const a=i.querySelectorAll(":scope > div, :scope > article");let r=0;a.forEach((o,c)=>{const u=o.className.toLowerCase(),x=this.cleanText(this.getVisibleText(o)),M=u.includes("user")||u.includes("human")||u.includes("outgoing")||u.includes("sent"),z=u.includes("assistant")||u.includes("bot")||u.includes("ai")||u.includes("response")||u.includes("incoming")||o.querySelector(".markdown, .prose, pre:not(.user-code)");(M||!z&&c%2===0)&&x&&x.length>5&&x.length<5e3&&!t.has(x)&&(t.add(x),e.push({content:x,index:r++}))})}),e}}const X=[new V,new U,new B,new O,new R,new D,new $,new G,new F,new H];function v(){return X.find(s=>s.detect())||null}function Z(){const s=v();return s?s.name:null}console.log("[PromptExtractor] Content script loaded");const g=v(),p=Z();console.log(`[PromptExtractor] Platform detected: ${p||"unknown"}`);let b=null,f=[];const K={chatgpt:['button[data-testid="send-button"]','button[data-testid="composer-send-button"]','form button[type="submit"]','button[aria-label*="Send"]'],claude:['button[aria-label="Send Message"]','button[type="submit"]',"fieldset button:last-child"],gemini:['button[aria-label*="Send"]',".send-button",'button[data-test-id="send-button"]'],perplexity:['button[aria-label="Submit"]','button[type="submit"]'],deepseek:['button[data-testid="send-button"]',".send-btn"],lovable:['button[type="submit"]','button[aria-label*="Send"]'],bolt:['button[type="submit"]',".send-button"],cursor:['button[type="submit"]'],"meta-ai":['button[aria-label*="Send"]','button[type="submit"]']},Q={chatgpt:["#prompt-textarea",'textarea[data-id="root"]','div[contenteditable="true"][data-placeholder]'],claude:['div[contenteditable="true"]',"fieldset div[contenteditable]"],gemini:[".ql-editor","rich-textarea div[contenteditable]","textarea"],perplexity:["textarea",'div[contenteditable="true"]'],deepseek:["textarea","#chat-input textarea"],lovable:["textarea"],bolt:["textarea"],cursor:["textarea"],"meta-ai":['div[contenteditable="true"]',"textarea"]};function P(s){var n,e;return s?s instanceof HTMLTextAreaElement?s.value.trim():s.getAttribute("contenteditable")==="true"&&(((n=s.innerText)==null?void 0:n.trim())||((e=s.textContent)==null?void 0:e.trim()))||"":""}function A(){const s=Q[p||""]||[];for(const t of s){const l=document.querySelector(t);if(l&&l.offsetParent!==null)return l}const n=document.querySelector('textarea:not([type="hidden"])');if(n&&n.offsetParent!==null)return n;const e=document.querySelector('[contenteditable="true"]');return e&&e.offsetParent!==null?e:null}function k(){const s=A(),n=P(s);return n&&n.length>0?(console.log("[PromptExtractor] Captured prompt:",n.slice(0,50)+"..."),n):null}function C(s){var l;if(!s||s.trim().length===0)return;const n=window.location.href,e=n.includes("/c/")||n.includes("/chat/")?n:`session_${p}_${Date.now()}`,t={content:s.trim(),index:f.length,timestamp:Date.now(),conversationId:e};f.push(t),(l=chrome.storage.session)==null||l.set({[`sessionPrompts_${p}`]:f}).catch(()=>{chrome.storage.local.set({[`sessionPrompts_${p}`]:f})}),console.log(`[PromptExtractor] Session prompts: ${f.length}`),chrome.runtime.sendMessage({action:"SAVE_SESSION_PROMPTS",prompts:f,platform:p||"unknown"})}async function j(){var s;try{const n=`sessionPrompts_${p}`,e=await((s=chrome.storage.session)==null?void 0:s.get(n))||await chrome.storage.local.get(n);e[n]&&(f=e[n],console.log(`[PromptExtractor] Loaded ${f.length} session prompts`))}catch{console.log("[PromptExtractor] Could not load session prompts")}}function y(){const s=K[p||""]||[];for(const n of s)document.querySelectorAll(n).forEach(t=>{t.getAttribute("data-pe-hooked")||(t.setAttribute("data-pe-hooked","true"),t.addEventListener("mousedown",()=>{const l=k();l&&(t.__peText=l)},!0),t.addEventListener("click",()=>{const l=t.__peText;l&&(C(l),t.__peText=null)},!0),console.log("[PromptExtractor] Hooked send button:",n))})}function E(){const s=A();!s||s.getAttribute("data-pe-key-hooked")||(s.setAttribute("data-pe-key-hooked","true"),s.addEventListener("keydown",n=>{const e=n.key==="Enter",t=n.key==="Enter"&&(n.ctrlKey||n.metaKey),l=n.key==="Enter"&&n.shiftKey;if(e&&!l||t){const d=k();d&&setTimeout(()=>{const i=P(s);(!i||i.length<d.length/2)&&C(d)},100)}},!0),console.log("[PromptExtractor] Hooked keyboard submit"))}function W(){if(!g||!p)return;j(),y(),E(),setInterval(()=>{y(),E()},2e3),new MutationObserver(()=>{y(),E()}).observe(document.body,{childList:!0,subtree:!0}),console.log("[PromptExtractor] Real-time capture initialized")}async function q(){const s=[...f],n=window.location.href,e=n.includes("/c/")||n.includes("/chat/")?n:null;let t=[];if(e)try{const i=await chrome.runtime.sendMessage({action:"GET_CONVERSATION_LOGS",platform:p,conversationId:e});i&&i.prompts&&(t=i.prompts)}catch(i){console.error("[PromptExtractor] Failed to fetch persistent logs:",i)}let l=[...t];const d=new Set(t.map(i=>S(i.content)));for(const i of s)d.has(S(i.content))||l.push(i);return l.length>0?(console.log(`[PromptExtractor] Using ${l.length} keylogged prompts (ignoring DOM)`),l.sort((i,a)=>(i.timestamp||0)-(a.timestamp||0))):(console.log("[PromptExtractor] No keylogs found, falling back to DOM scraping"),g?g.scrapePrompts():[])}function S(s){return s.toLowerCase().trim().replace(/\s+/g," ").slice(0,200)}function I(s){var t;const n=window.location.href,e=((t=s[0])==null?void 0:t.conversationId)||(n.includes("/c/")||n.includes("/chat/")?n:`session_${p}_${Date.now()}`);return{platform:p||"unknown",url:window.location.href,title:document.title,prompts:s,extractedAt:Date.now(),conversationId:e}}const Y=`
  /* Add space at top of container for Zone 1 */
  .pe-has-zone1 {
    padding-top: 44px !important;
    position: relative !important;
  }
  
  .pe-zone1 {
    position: absolute;
    top: 8px;
    left: 12px;
    display: flex;
    align-items: center;
    gap: 8px;
    font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'Segoe UI', Roboto, sans-serif;
    z-index: 10;
  }
  
  .pe-zone1-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 7px 16px;
    border-radius: 20px;
    font-size: 13px;
    font-weight: 500;
    cursor: pointer;
    transition: all 150ms ease;
    white-space: nowrap;
    line-height: 1;
    letter-spacing: 0.01em;
  }
  
  .pe-zone1-btn.extract {
    background: #ffffff;
    color: #1a1a1a;
    border: 1px solid #e0e0e0;
    box-shadow: 0 1px 2px rgba(0,0,0,0.04);
  }
  
  .pe-zone1-btn.extract:hover {
    background: #f5f5f5;
    border-color: #d0d0d0;
  }
  
  .pe-zone1-btn.summarize {
    background: #1a1a1a;
    color: #ffffff;
    border: 1px solid #1a1a1a;
    box-shadow: 0 1px 3px rgba(0,0,0,0.12);
  }
  
  .pe-zone1-btn.summarize:hover {
    background: #333333;
    border-color: #333333;
  }
  
  .pe-zone1-btn.paste {
    background: #f0f0f0;
    color: #1a1a1a;
    border: 1px solid #d0d0d0;
    animation: pe-fade-in 200ms ease-out;
  }
  
  .pe-zone1-btn.paste:hover {
    background: #e5e5e5;
  }
  
  .pe-zone1-btn:active {
    transform: scale(0.97);
  }
  
  .pe-zone1-btn.loading {
    opacity: 0.6;
    pointer-events: none;
  }
  
  .pe-zone1-btn svg {
    width: 14px;
    height: 14px;
    flex-shrink: 0;
    margin-right: 4px;
  }
  
  .pe-spinner {
    animation: pe-spin 0.8s linear infinite;
  }
  
  @keyframes pe-spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }
  
  @keyframes pe-fade-in {
    from { opacity: 0; transform: translateX(-8px); }
    to { opacity: 1; transform: translateX(0); }
  }
`,J={chatgpt:['form[class*="stretch"] > div > div','form.w-full > div > div[class*="relative"]','[data-testid="composer-background"]',"main form > div > div","#composer-background"],claude:['[data-testid="composer-container"]',".composer-container",'fieldset[class*="composer"]'],gemini:[".input-area-container","rich-textarea",".text-input-field_textarea-wrapper"],perplexity:['[data-testid="ask-input-container"]',".ask-input-container"],deepseek:[".chat-input-container","#chat-input"],lovable:[".prompt-input-container",'[data-testid="prompt-input"]'],bolt:[".chat-input",'[data-testid="chat-input"]'],cursor:[".input-container",'[data-testid="input"]'],"meta-ai":['[data-testid="composer"]',".composer"]};function ee(){const s=J[p||""]||[];for(const e of s){const t=document.querySelector(e);if(t&&t.offsetParent!==null)return console.log("[PromptExtractor] Found input via selector:",e),t}if(p==="chatgpt"){const e=document.querySelector('form[class*="stretch"], form.w-full');if(e){const t=e.querySelector('div[class*="rounded"]');if(t&&t.offsetParent!==null)return console.log("[PromptExtractor] Found ChatGPT inner container"),t;const l=e.querySelector(":scope > div > div");if(l)return console.log("[PromptExtractor] Found ChatGPT first div"),l}}const n=document.querySelectorAll('textarea, [contenteditable="true"]');for(const e of n)if(e.offsetParent!==null){let t=e.parentElement,l=0;for(;t&&l<6;){const d=window.getComputedStyle(t);if(d.borderRadius&&d.borderRadius!=="0px")return console.log("[PromptExtractor] Found container via textarea parent"),t;t=t.parentElement,l++}}return console.log("[PromptExtractor] Could not find input container"),null}function te(){if(document.getElementById("pe-styles"))return;const s=document.createElement("style");s.id="pe-styles",s.textContent=Y,document.head.appendChild(s)}function se(){const s=document.createElement("div");s.id="pe-zone1",s.className="pe-zone1";const n=document.createElement("button");n.id="pe-extract-btn",n.className="pe-zone1-btn extract",n.textContent="Extract",n.title="Extract raw prompts",n.onclick=t=>{t.preventDefault(),t.stopPropagation(),w("raw",n)},s.appendChild(n);const e=document.createElement("button");return e.id="pe-summarize-btn",e.className="pe-zone1-btn summarize",e.textContent="Summarise",e.title="AI-powered summary",e.onclick=t=>{t.preventDefault(),t.stopPropagation(),w("summary",e)},s.appendChild(e),s}function ne(){const s=document.getElementById("pe-zone1");if(!s||document.getElementById("pe-paste-btn"))return;const n=document.createElement("button");n.id="pe-paste-btn",n.className="pe-zone1-btn paste",n.textContent="Paste",n.title="Paste copied prompts",n.onclick=e=>{e.preventDefault(),e.stopPropagation(),re()},s.appendChild(n)}function oe(){const s=document.getElementById("pe-paste-btn");s&&s.remove()}function re(){if(!b)return;const s=document.querySelector("textarea"),n=document.querySelector('[contenteditable="true"]');if(s){const e=s.selectionStart||0,t=s.selectionEnd||0,l=s.value;s.value=l.substring(0,e)+b+l.substring(t),s.selectionStart=s.selectionEnd=e+b.length,s.dispatchEvent(new Event("input",{bubbles:!0})),s.focus()}else n&&(n.focus(),document.execCommand("insertText",!1,b));b=null,oe()}function T(){if(document.getElementById("pe-zone1")||!g)return;const s=window.location.href,n=s.includes("/c/")||s.includes("/chat/")||s.includes("/thread/");if((p==="chatgpt"||p==="claude")&&!n)return;const e=ee();if(!e){console.log("[PromptExtractor] Could not find input container");return}te(),e.classList.add("pe-has-zone1");const t=se();e.appendChild(t),console.log("[PromptExtractor] Zone 1 buttons injected")}async function w(s,n){const e=n.textContent;n.classList.add("loading"),n.innerHTML=`
    <svg class="pe-spinner" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
      <circle cx="12" cy="12" r="10" stroke-opacity="0.25"/>
      <path d="M12 2a10 10 0 0 1 10 10" stroke-linecap="round"/>
    </svg>
    ${s==="raw"?"Extracting...":"Summarising..."}
  `;try{const t=await q(),l=I(t);chrome.runtime.sendMessage({action:"EXTRACTION_FROM_PAGE",result:l,mode:s})}catch(t){console.error("[PromptExtractor] Error:",t)}finally{setTimeout(()=>{n.classList.remove("loading"),n.textContent=e},500)}}function L(){const s=document.getElementById("pe-zone1");s&&s.remove();const n=document.getElementById("pe-styles");n&&n.remove()}function ae(){let s=0;const n=30,e=()=>{document.getElementById("pe-zone1")||(T(),!document.getElementById("pe-zone1")&&s<n&&(s++,setTimeout(e,500)))};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",e):setTimeout(e,500),setInterval(()=>{const t=window.location.href,l=t.includes("/c/")||t.includes("/chat/")||t.includes("/thread/");p!=="chatgpt"&&p!=="claude"||l?!document.getElementById("pe-zone1")&&g&&T():L()},1e3)}chrome.runtime.onMessage.addListener((s,n,e)=>{switch(console.log("[PromptExtractor] Received message:",s.action),s.action){case"EXTRACT_PROMPTS":return q().then(t=>{const l=I(t);chrome.runtime.sendMessage({action:"EXTRACTION_RESULT",result:l}),e({success:!0,promptCount:t.length})}),!0;case"GET_STATUS":{e({action:"STATUS_RESULT",supported:!!g,platform:p});break}case"TOGGLE_BUTTONS":{s.visible?T():L(),e({success:!0});break}case"CONTENT_COPIED":{b=s.content,ne(),e({success:!0});break}default:e({success:!1,error:"Unknown action"})}return!0});chrome.runtime.sendMessage({action:"STATUS_RESULT",supported:!!g,platform:p});ae();W();
