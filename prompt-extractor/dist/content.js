var de=Object.defineProperty;var he=(p,b,S)=>b in p?de(p,b,{enumerable:!0,configurable:!0,writable:!0,value:S}):p[b]=S;var m=(p,b,S)=>he(p,typeof b!="symbol"?b+"":b,S);(function(){"use strict";class p{deepQuerySelectorAll(r,e=document){let t=Array.from(e.querySelectorAll(r));const l=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT);let i;for(;i=l.nextNode();){const c=i;c.shadowRoot&&(t=[...t,...this.deepQuerySelectorAll(r,c.shadowRoot)])}return t}cleanText(r){return r.replace(/\s+/g," ").trim()}isUIElement(r){return/^(copy|regenerate|share|edit|delete|save|retry|cancel|submit|send|stop|continue|new chat|clear)$/i.test(r.trim())||r.trim().length<3}getVisibleText(r){const e=r;return e.innerText||e.textContent||""}}class b extends p{constructor(){super(...arguments);m(this,"name","chatgpt")}detect(){return location.hostname.includes("chatgpt.com")||location.hostname.includes("chat.openai.com")}scrapePrompts(){const e=[],t=new Set,l=document.querySelectorAll('[data-message-author-role="user"]');if(l.length>0&&(l.forEach((s,n)=>{const u=this.cleanText(this.getVisibleText(s));u&&!this.isUIElement(u)&&!t.has(u)&&(t.add(u),e.push({content:u,index:n}))}),e.length>0)||(document.querySelectorAll('[data-testid^="conversation-turn-"]').forEach((s,n)=>{var w;if(!(s.querySelector('[data-message-author-role="user"]')||s.querySelector(".user-icon")||((w=s.textContent)==null?void 0:w.includes("You"))))return;const d=this.cleanText(this.getVisibleText(s));d&&!t.has(d)&&(t.add(d),e.push({content:d,index:n}))}),e.length>0))return e;const c=document.querySelectorAll("article");let a=0;return c.forEach(s=>{const n=s.querySelector(".markdown"),u=s.querySelector(".agent-turn");if(n||u)return;const d=this.cleanText(this.getVisibleText(s));d&&d.length>5&&!t.has(d)&&(t.add(d),e.push({content:d,index:a++}))}),e}}class S extends p{constructor(){super(...arguments);m(this,"name","claude")}detect(){return location.hostname.includes("claude.ai")}scrapePrompts(){const e=[],t=new Set,l=document.querySelectorAll('[data-testid="human-message"], .human-message, [class*="human"]');if(l.length>0&&(l.forEach((a,s)=>{const n=this.cleanText(this.getVisibleText(a));n&&!this.isUIElement(n)&&!t.has(n)&&(t.add(n),e.push({content:n,index:s}))}),e.length>0))return e;const i=document.querySelectorAll('[class*="message"], [class*="Message"]');let c=0;if(i.forEach(a=>{const s=a.className.toLowerCase();if(!(s.includes("assistant")||s.includes("ai")||s.includes("claude"))&&(s.includes("user")||s.includes("human"))){const n=this.cleanText(this.getVisibleText(a));n&&n.length>5&&!t.has(n)&&(t.add(n),e.push({content:n,index:c++}))}}),e.length===0){const a=document.querySelector('[class*="conversation"], [class*="chat"], main');a&&a.querySelectorAll(":scope > div").forEach((n,u)=>{if(!n.querySelector(".prose, .markdown, pre, code")){const d=this.cleanText(this.getVisibleText(n));d&&d.length>10&&!t.has(d)&&(t.add(d),e.push({content:d,index:u}))}})}return e}}class $ extends p{constructor(){super(...arguments);m(this,"name","gemini")}detect(){return location.hostname.includes("gemini.google.com")}scrapePrompts(){const e=[],t=new Set,l=this.deepQuerySelectorAll('user-query, [class*="user-query"], [class*="query-text"]');if(l.length>0&&(l.forEach((c,a)=>{const s=this.cleanText(this.getVisibleText(c));s&&!this.isUIElement(s)&&!t.has(s)&&(t.add(s),e.push({content:s,index:a}))}),e.length>0))return e;if(this.deepQuerySelectorAll(".query-content, .user-message, [data-query]").forEach((c,a)=>{const s=this.cleanText(this.getVisibleText(c));s&&s.length>3&&!t.has(s)&&(t.add(s),e.push({content:s,index:a}))}),e.length===0){const c=document.querySelector('main, [role="main"]');if(c){const a=c.querySelectorAll('[class*="turn"], [class*="message"]');let s=0;a.forEach(n=>{const u=n.className.toLowerCase();if(u.includes("model")||u.includes("response")||u.includes("answer"))return;const d=this.cleanText(this.getVisibleText(n));d&&d.length>5&&!t.has(d)&&(t.add(d),e.push({content:d,index:s++}))})}}return e}}class G extends p{constructor(){super(...arguments);m(this,"name","perplexity")}detect(){return location.hostname.includes("perplexity.ai")}scrapePrompts(){const e=[],t=new Set;if(document.querySelectorAll('[class*="query"], [class*="question"], [class*="user"]').forEach((i,c)=>{const a=i.className.toLowerCase();if(a.includes("answer")||a.includes("response")||a.includes("source"))return;const s=this.cleanText(this.getVisibleText(i));s&&s.length>5&&!this.isUIElement(s)&&!t.has(s)&&(t.add(s),e.push({content:s,index:c}))}),e.length===0){const i=document.querySelectorAll('[class*="thread"] > div, [class*="Thread"] > div');let c=0;i.forEach((a,s)=>{if(s%2===0){const n=this.cleanText(this.getVisibleText(a));n&&n.length>5&&!t.has(n)&&(t.add(n),e.push({content:n,index:c++}))}})}return e.length===0&&document.querySelectorAll('h1, h2, [class*="title"]').forEach((c,a)=>{const s=this.cleanText(this.getVisibleText(c));s&&s.length>10&&s.length<500&&!t.has(s)&&(t.add(s),e.push({content:s,index:a}))}),e}}class W extends p{constructor(){super(...arguments);m(this,"name","deepseek")}detect(){return location.hostname.includes("deepseek.com")}scrapePrompts(){const e=[],t=new Set;if(document.querySelectorAll('[class*="user"], [class*="User"], [data-role="user"]').forEach((a,s)=>{const n=this.cleanText(this.getVisibleText(a));n&&!this.isUIElement(n)&&!t.has(n)&&(t.add(n),e.push({content:n,index:s}))}),e.length>0)return e;const i=document.querySelectorAll('[class*="bubble"], [class*="message"]');let c=0;return i.forEach(a=>{const s=a.className.toLowerCase();if(!(s.includes("assistant")||s.includes("bot")||s.includes("ai"))&&(s.includes("user")||s.includes("human"))){const n=this.cleanText(this.getVisibleText(a));n&&n.length>3&&!t.has(n)&&(t.add(n),e.push({content:n,index:c++}))}}),e.length===0&&document.querySelectorAll("main div").forEach((s,n)=>{if(!s.querySelector(".ds-markdown")&&!s.closest(".ds-markdown")){const u=this.cleanText(this.getVisibleText(s));u&&u.length>10&&u.length<2e3&&!t.has(u)&&!u.includes("```")&&!u.startsWith("#")&&(t.add(u),e.push({content:u,index:n}))}}),e}}class Z extends p{constructor(){super(...arguments);m(this,"name","lovable")}detect(){return location.hostname.includes("lovable.dev")}scrapePrompts(){const e=[],t=new Set;if(document.querySelectorAll('[class*="user-message"], [class*="UserMessage"], [data-sender="user"]').forEach((c,a)=>{const s=this.cleanText(this.getVisibleText(c));s&&!this.isUIElement(s)&&!t.has(s)&&(t.add(s),e.push({content:s,index:a}))}),e.length>0)return e;if(document.querySelectorAll('[class*="editable"], [class*="edit-button"]').forEach((c,a)=>{const s=c.closest('[class*="message"]');if(s){const n=this.cleanText(this.getVisibleText(s));n&&n.length>5&&!t.has(n)&&(t.add(n),e.push({content:n,index:a}))}}),e.length===0){const c=document.querySelector('[class*="chat"], [class*="conversation"], [class*="messages"]');if(c){const a=c.querySelectorAll(":scope > div");let s=0;a.forEach(n=>{const u=n.className.toLowerCase();if(u.includes("bot")||u.includes("assistant")||u.includes("ai")||u.includes("system"))return;const d=this.cleanText(this.getVisibleText(n));d&&d.length>5&&!t.has(d)&&(t.add(d),e.push({content:d,index:s++}))})}}return e}}class H extends p{constructor(){super(...arguments);m(this,"name","bolt")}detect(){return location.hostname.includes("bolt.new")}scrapePrompts(){const e=[],t=new Set;if(document.querySelectorAll('[class*="user"], [class*="prompt"], [class*="input-message"]').forEach((a,s)=>{const n=a.className.toLowerCase();if(n.includes("assistant")||n.includes("response")||n.includes("output"))return;const u=this.cleanText(this.getVisibleText(a));u&&!this.isUIElement(u)&&!t.has(u)&&(t.add(u),e.push({content:u,index:s}))}),e.length>0)return e;const i=document.querySelectorAll('[class*="message"], [class*="Message"]');let c=0;return i.forEach(a=>{const s=a.className.toLowerCase();if(s.includes("user")||s.includes("human")||s.includes("you")){const n=this.cleanText(this.getVisibleText(a));n&&n.length>3&&!t.has(n)&&(t.add(n),e.push({content:n,index:c++}))}}),e.length===0&&document.querySelectorAll('[class*="workspace"] [class*="prompt"], [class*="project"] [class*="request"]').forEach((s,n)=>{const u=this.cleanText(this.getVisibleText(s));u&&u.length>5&&!t.has(u)&&(t.add(u),e.push({content:u,index:n}))}),e}}class K extends p{constructor(){super(...arguments);m(this,"name","cursor")}detect(){return location.hostname.includes("cursor.sh")||location.hostname.includes("cursor.com")}scrapePrompts(){const e=[],t=new Set;if(document.querySelectorAll('[class*="user-message"], [class*="UserMessage"], [data-role="user"]').forEach((a,s)=>{const n=this.cleanText(this.getVisibleText(a));n&&!this.isUIElement(n)&&!t.has(n)&&(t.add(n),e.push({content:n,index:s}))}),e.length>0)return e;const i=document.querySelectorAll('[class*="chat"] [class*="message"], [class*="conversation"] [class*="turn"]');let c=0;return i.forEach(a=>{const s=a.className.toLowerCase();if(s.includes("assistant")||s.includes("bot")||s.includes("ai")||s.includes("response"))return;const n=this.cleanText(this.getVisibleText(a));n&&n.length>3&&!t.has(n)&&(t.add(n),e.push({content:n,index:c++}))}),e.length===0&&document.querySelectorAll('[class*="command"], [class*="prompt-history"], [class*="input-history"]').forEach((s,n)=>{const u=this.cleanText(this.getVisibleText(s));u&&u.length>5&&!t.has(u)&&(t.add(u),e.push({content:u,index:n}))}),e}}class X extends p{constructor(){super(...arguments);m(this,"name","meta-ai")}detect(){return location.hostname.includes("meta.ai")}scrapePrompts(){const e=[],t=new Set;if(document.querySelectorAll('[class*="user"], [class*="User"], [data-type="user"]').forEach((a,s)=>{const n=a.className.toLowerCase();if(n.includes("assistant")||n.includes("response")||n.includes("meta"))return;const u=this.cleanText(this.getVisibleText(a));u&&!this.isUIElement(u)&&!t.has(u)&&(t.add(u),e.push({content:u,index:s}))}),e.length>0)return e;const i=document.querySelectorAll('[class*="bubble"], [class*="Bubble"]');let c=0;if(i.forEach(a=>{const s=a.className.toLowerCase();if(s.includes("right")||s.includes("user")||s.includes("outgoing")){const n=this.cleanText(this.getVisibleText(a));n&&n.length>3&&!t.has(n)&&(t.add(n),e.push({content:n,index:c++}))}}),e.length===0){const a=document.querySelector('[class*="thread"], [class*="conversation"], [role="log"]');a&&a.querySelectorAll(":scope > div, :scope > li").forEach((n,u)=>{if(n.querySelector('.markdown, pre, code, [class*="response"]'))return;const d=this.cleanText(this.getVisibleText(n));d&&d.length>5&&d.length<2e3&&!t.has(d)&&(t.add(d),e.push({content:d,index:u}))})}return e}}class j extends p{constructor(){super(...arguments);m(this,"name","generic")}detect(){return!0}scrapePrompts(){const e=window.location.href;let t=[];if(e.includes("gemini.google.com")){const i=(a,s=document)=>{let n=[];s.querySelectorAll(a).forEach(w=>n.push(w));const u=document.createTreeWalker(s,NodeFilter.SHOW_ELEMENT,null);let d;for(;d=u.nextNode();)d.shadowRoot&&(n=n.concat(i(a,d.shadowRoot)));return n},c=i("user-query");if(c.length>0)return c.map((a,s)=>{var u;const n=(u=a.innerText)==null?void 0:u.trim();return n&&n.length>0?{content:n,index:s}:null}).filter(a=>a!==null)}const l=this.findChatContainer();return l&&(t=this.extractMessages(l)),t.length>1e3&&(console.warn("[SahAI] Truncating extraction at 1000 prompts safety limit"),t=t.slice(0,1e3)),t.map((i,c)=>({content:i.content,index:c}))}findChatContainer(){const e=["infinite-scroller",'[role="log"]','[role="main"]',".chat-history",".conversation","main"];for(const t of e){const l=document.querySelector(t);if(l&&l.innerText.length>200)return l}return document.body}extractMessages(e){var c;const t=[],l=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null);let i;for(;i=l.nextNode();){const a=((c=i.textContent)==null?void 0:c.trim())||"",s=i.parentElement;if(a.length<2||this.isSystemNoise(a)||(s==null?void 0:s.tagName.toLowerCase())==="model-response"||s!=null&&s.classList.contains("model-response-text")||(s==null?void 0:s.getAttribute("data-message-author-role"))==="assistant")continue;const n=a.toLowerCase();if(![/should be written (about|on|for)/i,/the story should/i,/story for class \d+/i,/resulting in a positive resolution/i,/clear moral about/i,/focus on (friendship|teamwork|cooperation)/i,/\bmet near\b/i,/help solve through/i,/spend time together/i].some(u=>u.test(a))&&![/^(one|a) (bright|sunny|dark|cold|warm|beautiful|clear) (day|morning|evening|night)/i,/once upon a time/i,/the end/i,/chapter \d+/i,/lived (his|her|their) life/i,/was a (golden retriever|cow|dog|cat|yellow frog|rabbit)/i,/near a (clear|beautiful|sparkling|calm) (pond|river|lake|stream)/i,/who met near/i,/faces a small problem/i].some(u=>u.test(a))&&!(n.startsWith("here is")||n.startsWith("sure, i can")||n.startsWith("i have")||n.startsWith("certainly")||n.startsWith("of course")||n.startsWith("here's a"))){if(a.length>200){const u=["create","write","make","fix","generate","build","explain","how","what","why","list","show","tell","give","help","find","debug"],d=a.split(" ")[0].toLowerCase();if(!u.includes(d))continue}n.includes("the cow, dog, and")||n.includes("yellow frog")||n.includes("calm problem-solving")||n.includes("summarai turns")||n.includes("scattered ai conversations")||n.includes("actionable workflow")||n.includes("work with ai with an edge")||n.includes("generates summaries of all prompts")||n.includes("no duplicates")||n.includes("cancel out the conflict")||/^(\d+\.|-|\*|â€¢)?\s*(the image shows|image of|this image depicts)/i.test(a)||t.push({role:"user",content:a})}}return this.mergeFragments(t)}isSystemNoise(e){return["Regenerate","Modify","Share","Google","Copy","Bad response","Good response"].includes(e)}mergeFragments(e){if(e.length===0)return[];const t=[];let l={...e[0]};for(let i=1;i<e.length;i++){const c=e[i];c.role===l.role?l.content+=`
`+c.content:(t.push(l),l={...c})}return t.push(l),t}}const Q=[new b,new S,new $,new G,new W,new Z,new H,new K,new X,new j];function P(){return Q.find(o=>o.detect())||null}function Y(){const o=P();return o?o.name:null}const z={version:1,platforms:{chatgpt:{userSelectors:['[data-message-author-role="user"]',".user-message"],buttonSelectors:['button[data-testid="send-button"]'],inputSelectors:["#prompt-textarea"]},claude:{userSelectors:[".font-user-message",'[data-test-id="user-message"]'],buttonSelectors:['button[aria-label="Send Message"]'],inputSelectors:['div[contenteditable="true"]']}}},C="remote_selector_config",J="remote_config_last_fetch",x=class x{constructor(){m(this,"config",z)}static getInstance(){return x.instance||(x.instance=new x),x.instance}async initialize(){const r=await chrome.storage.local.get([C,J]);r[C]&&(this.config={...z,...r[C]})}getSelectors(r){return this.config.platforms[r]||null}};m(x,"instance");let k=x;const g=P(),h=Y();k.getInstance().initialize(),console.log("[SahAI] Content script loaded v1.0.6"),console.log(`[SahAI] URL: ${window.location.href}`),console.log(`[SahAI] Platform detected: ${h||"unknown"}`);let f=[];window.__pe_debug={adapter:g,platformName:h,sessionPrompts:f,getConversationId:T,findInputContainer:D},g||console.warn("[SahAI] No adapter found for this page. Buttons will not be shown.");let y=null;const ee={chatgpt:['button[data-testid="send-button"]','button[data-testid="composer-send-button"]','form button[type="submit"]','button[aria-label*="Send"]'],claude:['button[aria-label="Send Message"]','button[type="submit"]',"fieldset button:last-child"],gemini:['button[aria-label*="Send"]',".send-button",'button[data-test-id="send-button"]'],perplexity:['button[aria-label="Submit"]','button[type="submit"]'],deepseek:['button[data-testid="send-button"]',".send-btn"],lovable:['button[type="submit"]','button[aria-label*="Send"]'],bolt:['button[type="submit"]',".send-button"],cursor:['button[type="submit"]'],"meta-ai":['button[aria-label*="Send"]','button[type="submit"]']},te={chatgpt:["#prompt-textarea",'textarea[data-id="root"]','div[contenteditable="true"][data-placeholder]'],claude:['div[contenteditable="true"]',"fieldset div[contenteditable]"],gemini:[".ql-editor","rich-textarea div[contenteditable]","textarea"],perplexity:["textarea",'div[contenteditable="true"]'],deepseek:["textarea","#chat-input textarea"],lovable:["textarea"],bolt:["textarea"],cursor:["textarea"],"meta-ai":['div[contenteditable="true"]',"textarea"]};function N(o){var r,e;return o?o instanceof HTMLTextAreaElement?o.value.trim():o.getAttribute("contenteditable")==="true"&&(((r=o.innerText)==null?void 0:r.trim())||((e=o.textContent)==null?void 0:e.trim()))||"":""}function M(){const o=te[h||""]||[];for(const t of o){const l=document.querySelector(t);if(l&&l.offsetParent!==null)return l}const r=document.querySelector('textarea:not([type="hidden"])');if(r&&r.offsetParent!==null)return r;const e=document.querySelector('[contenteditable="true"]');return e&&e.offsetParent!==null?e:null}function U(){const o=M(),r=N(o);return r&&r.length>0?(console.log("[SahAI] Captured prompt:",r.slice(0,50)+"..."),r):null}function T(){const o=window.location.href,e={chatgpt:/\/c\/([a-zA-Z0-9-]+)/,claude:/\/chat\/([a-zA-Z0-9-]+)/,gemini:/\/app\/([a-zA-Z0-9-]+)/,perplexity:/\/search\/([a-zA-Z0-9-]+)/,deepseek:/\/chat\/([a-zA-Z0-9-]+)/}[h||""];if(e){const l=o.match(e);if(l)return l[1]}const t=new URL(o).pathname;return`fallback_${ne(t)}`}function ne(o){let r=0;for(let e=0;e<o.length;e++){const t=o.charCodeAt(e);r=(r<<5)-r+t,r=r&r}return Math.abs(r).toString(36)}function _(){const o=T();return`sessionPrompts_${h}_${o}`}function O(o){var a;if(!o||o.trim().length===0)return;const r=T(),e=o.trim();if(f.some(s=>E(s.content)===E(e))){console.log("[SahAI] Skipping duplicate prompt");return}const l={content:e,index:f.length,timestamp:Date.now(),conversationId:r};f.push(l);const i=_();(a=chrome.storage.session)==null||a.set({[i]:f}).catch(()=>{chrome.storage.local.set({[i]:f})}),console.log(`[SahAI] Session prompts for ${r}: ${f.length}`);const c=(s=2)=>{chrome.runtime.sendMessage({action:"SAVE_SESSION_PROMPTS",prompts:[l],platform:h||"unknown",conversationId:r},n=>{chrome.runtime.lastError?(console.warn("[SahAI] Failed to save prompt:",chrome.runtime.lastError.message),s>0?setTimeout(()=>c(s-1),500):console.error("[SahAI] Could not save prompt after retries. Data saved locally only.")):n!=null&&n.success&&console.log("[SahAI] Prompt saved to background")})};c()}async function q(){var o;try{const r=_(),e=await((o=chrome.storage.session)==null?void 0:o.get(r))||await chrome.storage.local.get(r);e[r]&&(f=e[r],console.log(`[SahAI] Loaded ${f.length} session prompts for conversation`))}catch{console.log("[SahAI] Could not load session prompts")}}function v(){const o=ee[h||""]||[];for(const r of o)document.querySelectorAll(r).forEach(t=>{t.getAttribute("data-pe-hooked")||(t.setAttribute("data-pe-hooked","true"),t.addEventListener("mousedown",()=>{const l=U();l&&(t.__peText=l)},!0),t.addEventListener("click",()=>{const l=t.__peText;l&&(O(l),t.__peText=null)},!0),console.log("[SahAI] Hooked send button:",r))})}function A(){const o=M();if(!o||o.getAttribute("data-pe-key-hooked"))return;o.setAttribute("data-pe-key-hooked","true");let r=null;o.addEventListener("keydown",t=>{const l=t.key==="Enter",i=t.key==="Enter"&&(t.ctrlKey||t.metaKey),c=t.key==="Enter"&&t.shiftKey;if(l&&!c||i){const a=U();a&&a.length>0&&(r={text:a,timestamp:Date.now()})}},!0);const e=new MutationObserver(()=>{if(!r)return;if(Date.now()-r.timestamp>2e3){r=null;return}const t=N(o);(!t||t.length<10)&&(O(r.text),r=null)});e.observe(o,{childList:!0,subtree:!0,characterData:!0,attributes:!0,attributeFilter:["value"]}),o.parentElement&&e.observe(o.parentElement,{childList:!0}),console.log("[SahAI] Hooked keyboard submit with MutationObserver")}function se(){if(!g||!h)return;q(),v(),A();let o=null;new MutationObserver(()=>{o&&clearTimeout(o),o=setTimeout(()=>{v(),A()},500)}).observe(document.body,{childList:!0,subtree:!0});let e=location.href;new MutationObserver(()=>{location.href!==e&&(e=location.href,console.log("[SahAI] URL changed, reloading session"),f=[],q(),setTimeout(()=>{v(),A()},1e3))}).observe(document.body,{childList:!0,subtree:!0}),console.log("[SahAI] Real-time capture initialized (optimized)")}async function R(){const o=[...f],r=T();let e=[];if(r)try{console.log("[SahAI] Fetching persistent logs for:",r);const i=chrome.runtime.sendMessage({action:"GET_CONVERSATION_LOGS",platform:h,conversationId:r}),c=new Promise(s=>setTimeout(()=>s({prompts:[]}),1500)),a=await Promise.race([i,c]);a&&a.prompts&&(e=a.prompts,console.log(`[SahAI] Found ${e.length} persistent prompts`))}catch(i){console.error("[SahAI] Failed to fetch persistent logs:",i)}let t=[...e];const l=new Set(e.map(i=>E(i.content)));for(const i of o)l.has(E(i.content))||t.push(i);if(t.length>0)return console.log(`[SahAI] Using ${t.length} keylogged prompts (ignoring DOM)`),t.sort((i,c)=>(i.timestamp||0)-(c.timestamp||0));if(console.log("[SahAI] No keylogs found, falling back to DOM scraping"),g){const i=g.scrapePrompts();return i.length===0&&g.name!=="generic"&&console.log("[SahAI] Specific adapter returned 0 prompts. Attempting self-healing with Generic Smart Scraper..."),i}return[]}function E(o){return o.toLowerCase().trim().replace(/\s+/g," ").slice(0,200)}function B(o){const r=T();return{platform:h||"unknown",url:window.location.href,title:document.title,prompts:o,extractedAt:Date.now(),conversationId:r}}const oe=`
  /* Add space at top of container for Zone 1 */
  .pe-has-zone1 {
    padding-top: 44px !important;
    position: relative !important;
    min-height: 44px !important;
  }
  
  .pe-zone1 {
    position: absolute;
    top: 8px; /* Inside the 44px padding */
    left: 12px;
    display: flex;
    align-items: center;
    gap: 8px;
    font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'Segoe UI', Roboto, sans-serif;
    z-index: 9999999 !important;
  }
  
  .pe-zone1-btn {
    display: inline-flex !important;
    visibility: visible !important;
    opacity: 1 !important;
    align-items: center;
    justify-content: center;
    padding: 7px 16px;
    border-radius: 20px;
    font-size: 13px;
    font-weight: 500;
    cursor: pointer;
    transition: all 150ms ease;
    white-space: nowrap;
    line-height: 1;
    letter-spacing: 0.01em;
  }
  
  .pe-zone1-btn.extract {
    background: #ffffff !important;
    color: #000000 !important;
    border: 1px solid #d1d1d1 !important;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1) !important;
  }
  
  .pe-zone1-btn.extract:hover {
    background: #f0f0f0 !important;
    transform: translateY(-1px);
  }
  
  .pe-zone1-btn.summarize {
    background: #000000 !important;
    color: #ffffff !important;
    border: 1px solid #333333 !important;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2) !important;
  }
  
  .pe-zone1-btn.summarize:hover {
    background: #222222 !important;
    transform: translateY(-1px);
  }
  
  .pe-zone1-btn.paste {
    background: #f0f0f0;
    color: #1a1a1a;
    border: 1px solid #d0d0d0;
    animation: pe-fade-in 200ms ease-out;
  }
  
  .pe-zone1-btn.paste:hover {
    background: #e5e5e5;
  }
  
  .pe-zone1-btn:active {
    transform: scale(0.97);
  }
  
  .pe-zone1-btn.loading {
    opacity: 0.6;
    pointer-events: none;
  }
  
  .pe-zone1-btn svg {
    width: 14px;
    height: 14px;
    flex-shrink: 0;
    margin-right: 4px;
  }
  
  .pe-spinner {
    animation: pe-spin 0.8s linear infinite;
  }
  
  @keyframes pe-spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }
  
  @keyframes pe-fade-in {
    from { opacity: 0; transform: translateX(-8px); }
    to { opacity: 1; transform: translateX(0); }
  }
`,V={chatgpt:["#composer-background",'[data-testid="composer-background"]',"#prompt-textarea-wrapper",'form[class*="stretch"] > div > div','form.w-full > div > div[class*="relative"]',"main form > div > div"],claude:['[data-testid="composer-container"]',".composer-container",'fieldset[class*="composer"]'],gemini:[".input-area-container","rich-textarea",".text-input-field_textarea-wrapper"],perplexity:['[data-testid="ask-input-container"]',".ask-input-container"],deepseek:[".chat-input-container","#chat-input"],lovable:[".prompt-input-container",'[data-testid="prompt-input"]'],bolt:[".chat-input",'[data-testid="chat-input"]'],cursor:[".input-container",'[data-testid="input"]'],"meta-ai":['[data-testid="composer"]',".composer"]};function D(){const o=V[h||""]||[];for(const i of o){const c=document.querySelector(i);if(c&&c.offsetParent!==null){if(c.getBoundingClientRect().height>300&&h==="chatgpt"){console.log("[SahAI] Skipping selector (too tall):",i);continue}return console.log("[SahAI] Found input via selector:",i),c}}if(h==="chatgpt"){const i=document.querySelector('form[class*="stretch"], form.w-full');if(i){const c=i.querySelector('div[class*="rounded"]');if(c&&c.offsetParent!==null)return console.log("[SahAI] Found ChatGPT inner container"),c;const a=i.querySelector(":scope > div > div");if(a)return console.log("[SahAI] Found ChatGPT first div"),a}}const r=document.querySelectorAll('textarea, [contenteditable="true"]');for(const i of r)if(i.offsetParent!==null){let c=i.parentElement,a=0;for(;c&&a<6;){const s=window.getComputedStyle(c);if(s.borderRadius&&s.borderRadius!=="0px")return console.log("[SahAI] Found container via textarea parent"),c;c=c.parentElement,a++}}const e=document.querySelectorAll("form");for(const i of e)if(i.querySelector('textarea, [contenteditable="true"]'))return console.log("[SahAI] Found container via form with textarea"),i;const t=document.querySelectorAll('div[class*="composer"], div[class*="input"], div[class*="prompt"], div[class*="chat"]');for(const i of t)if(i.offsetParent!==null&&i.querySelector('textarea, [contenteditable="true"]'))return console.log("[SahAI] Found container via heuristic"),i;const l=document.querySelector('textarea:not([type="hidden"]), [contenteditable="true"]');return l&&l.offsetParent!==null?(console.log("[SahAI] Found container via first visible textarea parent"),l.parentElement):(console.log("[SahAI] Could not find input container"),null)}function re(){if(document.getElementById("pe-styles"))return;const o=document.createElement("style");o.id="pe-styles",o.textContent=oe,document.head.appendChild(o)}function ae(){console.log("[SahAI] Creating Zone 1 buttons...");const o=document.createElement("div");o.id="pe-zone1",o.className="pe-zone1";const r=document.createElement("button");r.id="pe-extract-btn",r.className="pe-zone1-btn extract",r.textContent="Extract",r.title="Extract raw prompts",r.onclick=t=>{t.preventDefault(),t.stopPropagation(),F("raw",r)},o.appendChild(r);const e=document.createElement("button");return e.id="pe-summarize-btn",e.className="pe-zone1-btn summarize",e.textContent="Summarise",e.title="AI-powered summary",e.onclick=t=>{t.preventDefault(),t.stopPropagation(),F("summary",e)},o.appendChild(e),o}function ie(){const o=document.getElementById("pe-zone1");if(!o||document.getElementById("pe-paste-btn"))return;const r=document.createElement("button");r.id="pe-paste-btn",r.className="pe-zone1-btn paste",r.textContent="Paste",r.title="Paste copied prompts",r.onclick=e=>{e.preventDefault(),e.stopPropagation(),le()},o.appendChild(r)}function ce(){const o=document.getElementById("pe-paste-btn");o&&o.remove()}function le(){if(!y)return;const o=document.querySelector("textarea"),r=document.querySelector('[contenteditable="true"]');if(o){const e=o.selectionStart||0,t=o.selectionEnd||0,l=o.value;o.value=l.substring(0,e)+y+l.substring(t),o.selectionStart=o.selectionEnd=e+y.length,o.dispatchEvent(new Event("input",{bubbles:!0})),o.focus()}else r&&(r.focus(),document.execCommand("insertText",!1,y));y=null,ce()}function I(){if(document.getElementById("pe-zone1")||!g)return;const o=window.location.href,r=o.includes("/c/")||o.includes("/chat/")||o.includes("/thread/"),e=new URL(o),t=(e.hostname.includes("chatgpt.com")||e.hostname.includes("openai.com"))&&(e.pathname==="/"||e.pathname==="");if(console.log(`[SahAI] createZonedLayout: hasConversationId=${r}, isRootPath=${t}`),(h==="chatgpt"||h==="claude")&&!r&&!t){console.log("[SahAI] Skipping buttons: Not in a conversation or root path");return}const l=D();if(!l){console.warn("[SahAI] Could not find input container. Tried selectors:",V[h||""]);return}re(),l.classList.add("pe-has-zone1");const i=ae();l.prepend(i);const c=l.getBoundingClientRect();console.log(`[SahAI] Zone 1 buttons injected. Container size: ${c.width}x${c.height} at (${c.left}, ${c.top})`)}async function F(o,r){const e=r.textContent;r.classList.add("loading"),r.innerHTML=`
    <svg class="pe-spinner" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
      <circle cx="12" cy="12" r="10" stroke-opacity="0.25"/>
      <path d="M12 2a10 10 0 0 1 10 10" stroke-linecap="round"/>
    </svg>
    ${o==="raw"?"Extracting...":"Summarising..."}
  `;try{const t=await R(),l=B(t);chrome.runtime.sendMessage({action:"EXTRACTION_FROM_PAGE",result:l,mode:o})}catch(t){console.error("[SahAI] Error:",t)}finally{setTimeout(()=>{r.classList.remove("loading"),r.textContent=e},500)}}function L(){const o=document.getElementById("pe-zone1");o&&o.remove();const r=document.getElementById("pe-styles");r&&r.remove()}function ue(){let o=0;const r=10,e=()=>{document.getElementById("pe-zone1")||(I(),!document.getElementById("pe-zone1")&&o<r&&(o++,setTimeout(e,500)))};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",e):setTimeout(e,500);let t=location.href,l=!1;const i=()=>{if(l)return;l=!0,(window.requestIdleCallback||(n=>setTimeout(n,100)))(()=>{l=!1,location.href!==t&&(t=location.href,console.log("[SahAI] URL change detected"));const n=window.location.href,u=n.includes("/c/")||n.includes("/chat/")||n.includes("/thread/"),d=new URL(n),w=(d.hostname.includes("chatgpt.com")||d.hostname.includes("openai.com"))&&(d.pathname==="/"||d.pathname==="");h!=="chatgpt"&&h!=="claude"||u||w?!document.getElementById("pe-zone1")&&g&&I():document.getElementById("pe-zone1")&&(console.log("[SahAI] Removing buttons: No longer in a valid conversation"),L())},{timeout:2e3})},c=document.querySelector("main")||document.body;new MutationObserver(s=>{s.some(u=>u.type==="childList"&&u.addedNodes.length>0)&&i()}).observe(c,{childList:!0,subtree:!0,attributes:!1,characterData:!1}),i()}chrome.runtime.onMessage.addListener((o,r,e)=>{switch(console.log("[SahAI] Received message:",o.action),o.action){case"URL_CHANGED":{console.log("[SahAI] URL changed, resetting session"),f=[],q(),document.getElementById("pe-zone1")&&L(),setTimeout(()=>{I(),v(),A()},500),e({success:!0});break}case"EXTRACT_PROMPTS":return R().then(t=>{const l=B(t);chrome.runtime.sendMessage({action:"EXTRACTION_RESULT",result:l}),e({success:!0,promptCount:t.length})}).catch(t=>{console.error("[SahAI] Extraction failed:",t),e({success:!1,error:t.message})}),!0;case"GET_STATUS":{e({action:"STATUS_RESULT",supported:!!g,platform:h});break}case"TOGGLE_BUTTONS":{o.visible?I():L(),e({success:!0});break}case"CONTENT_COPIED":{y=o.content,ie(),e({success:!0});break}default:e({success:!1,error:"Unknown action"})}return!0}),chrome.runtime.sendMessage({action:"STATUS_RESULT",supported:!!g,platform:h}),ue(),se()})();
